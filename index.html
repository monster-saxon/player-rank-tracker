<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Player Rank Tracker</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.png">
<meta name="theme-color" content="#0e1525">
<style>
  :root{ --bg:#0e1525; --card:#111827; --muted:#9aa4b2; --accent:#00ae8c; --danger:#ff6a6a; }
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#071025,#0e1525);color:#e6eef6;margin:0;padding:18px}
  .wrap{max-width:980px;margin:0 auto}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  .sub{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:16px;margin-top:14px}
  .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  input[type="text"], input[type="number"], select, textarea{width:100%;padding:9px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:inherit}
  textarea{min-height:80px}
  .btn{background:linear-gradient(90deg,var(--accent),#29c7a1);border:0;padding:9px 12px;border-radius:8px;color:#04211a;font-weight:700;cursor:pointer}
  .muted{color:var(--muted)}
  .list{display:grid;gap:8px;margin-top:8px}
  .player{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
  .meta{min-width:0}
  .meta b{display:block}
  .meta small{color:var(--muted);display:block;font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .pill{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:700}
  .promoted{background:rgba(0,174,140,0.12);color:var(--accent);padding:6px 8px;border-radius:8px;font-weight:700}
  .actions button{background:transparent;border:0;color:var(--muted);cursor:pointer;margin-left:8px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Player Rank Tracker</h1>
      <div class="sub">Track players, ranks, and promotions â€” installable PWA (offline)</div>
    </div>
    <div>
      <button id="installBtn" class="btn">Install App</button>
    </div>
  </header>

  <div class="grid">
    <div class="card">
      <form id="playerForm">
        <input type="hidden" id="playerId">
        <label>Player name</label>
        <input id="name" type="text" placeholder="e.g., Alex" required>
        <label>Current rank (number)</label>
        <input id="rank" type="number" min="0" required>
        <label>Previous rank (optional)</label>
        <input id="prevRank" type="number" min="0">
        <label>Notes</label>
        <textarea id="notes" placeholder="Optional notes"></textarea>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" type="submit">Save</button>
          <button id="clearBtn" type="button" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:8px 12px;border-radius:8px">Clear</button>
        </div>
      </form>

      <hr style="border:0;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
      <div style="display:flex;gap:8px;align-items:center">
        <input id="search" type="text" placeholder="Search name or notes" style="flex:1">
        <select id="filter" style="width:160px">
          <option value="all">All</option>
          <option value="promoted">Promoted</option>
          <option value="not">Not promoted</option>
        </select>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="muted">Players</div>
          <div id="count" style="font-weight:800;font-size:18px">0</div>
        </div>
        <div class="muted" id="lastSaved">No saves yet</div>
      </div>

      <div id="list" class="list"></div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="exportBtn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Export JSON</button>
        <button id="importBtn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Import JSON</button>
        <button id="clearAll" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--danger)">Clear All</button>
      </div>
      <input id="fileInput" type="file" accept="application/json" style="display:none">
    </div>
  </div>
</div>

<script>
const STORAGE_KEY = 'rank-tracker-v1';
let players = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

const listEl = document.getElementById('list');
const form = document.getElementById('playerForm');
const nameInput = document.getElementById('name');
const rankInput = document.getElementById('rank');
const prevInput = document.getElementById('prevRank');
const notesInput = document.getElementById('notes');
const idInput = document.getElementById('playerId');
const searchInput = document.getElementById('search');
const filterSelect = document.getElementById('filter');
const countEl = document.getElementById('count');
const lastSaved = document.getElementById('lastSaved');
const fileInput = document.getElementById('fileInput');

function uid() { return 'p_' + Math.random().toString(36).slice(2,9); }

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(players));
  lastSaved.textContent = 'Saved ' + new Date().toLocaleString();
}

function render() {
  const q = searchInput.value.trim().toLowerCase();
  const f = filterSelect.value;
  let visible = players.slice().filter(p => {
    if (q && !(p.name.toLowerCase().includes(q) || (p.notes||'').toLowerCase().includes(q))) return false;
    if (f === 'promoted') return (p.prevRank !== null && Number(p.rank) > Number(p.prevRank));
    if (f === 'not') return !(p.prevRank !== null && Number(p.rank) > Number(p.prevRank));
    return true;
  });
  countEl.textContent = visible.length;
  listEl.innerHTML = '';
  if (!visible.length) { listEl.innerHTML = '<div class="muted">No players found.</div>'; return; }
  visible.forEach(p => {
    const promoted = (p.prevRank !== null && Number(p.rank) > Number(p.prevRank));
    const item = document.createElement('div'); item.className = 'player';
    item.innerHTML = `
      <div class="meta">
        <b>${p.name}</b>
        <small>${p.prevRank !== null ? 'Prev: ' + p.prevRank + ' â€¢ ' : ''}Rank: ${p.rank} â€¢ ${p.notes || ''}</small>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <div class="${promoted ? 'promoted' : 'pill'}">${promoted ? 'PROMOTED' : 'NOT PROMOTED'}</div>
        <div class="actions">
          <button onclick="editPlayer('${p.id}')">âœŽ</button>
          <button onclick="deletePlayer('${p.id}')">ðŸ—‘</button>
        </div>
      </div>
    `;
    listEl.appendChild(item);
  });
}

form.addEventListener('submit', (e) => {
  e.preventDefault();
  const id = idInput.value || uid();
  const obj = {
    id,
    name: nameInput.value.trim(),
    rank: Number(rankInput.value),
    prevRank: prevInput.value ? Number(prevInput.value) : null,
    notes: notesInput.value.trim(),
    updated: Date.now()
  };
  players = players.filter(p => p.id !== id);
  players.unshift(obj);
  save(); render(); form.reset(); idInput.value='';
});

function editPlayer(id) {
  const p = players.find(x => x.id === id);
  if (!p) return;
  idInput.value = p.id;
  nameInput.value = p.name;
  rankInput.value = p.rank;
  prevInput.value = p.prevRank !== null ? p.prevRank : '';
  notesInput.value = p.notes || '';
  window.scrollTo({top:0,behavior:'smooth'});
}

function deletePlayer(id) {
  if (!confirm('Delete this player?')) return;
  players = players.filter(p => p.id !== id);
  save(); render();
}

document.getElementById('clearBtn').addEventListener('click', () => { form.reset(); idInput.value=''; });
searchInput.addEventListener('input', render);
filterSelect.addEventListener('change', render);
document.getElementById('clearAll').addEventListener('click', () => {
  if (!confirm('Remove all players?')) return;
  players = []; save(); render();
});

// Export / Import
document.getElementById('exportBtn').addEventListener('click', () => {
  const blob = new Blob([JSON.stringify(players, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'players-backup.json'; a.click();
  URL.revokeObjectURL(url);
});
document.getElementById('importBtn').addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', (e) => {
  const f = e.target.files[0]; if (!f) return;
  const r = new FileReader();
  r.onload = () => {
    try {
      const parsed = JSON.parse(r.result);
      if (!Array.isArray(parsed)) throw new Error('Invalid format');
      players = parsed.map(x => ({ id: x.id || uid(), name: x.name||'', rank: x.rank||0, prevRank: x.prevRank!=null?x.prevRank:null, notes: x.notes||'', updated: x.updated||Date.now() }));
      save(); render(); alert('Imported data.');
    } catch (err) { alert('Failed to import: ' + err.message); }
  };
  r.readAsText(f); fileInput.value='';
});

// Install prompt
let deferredPrompt;
const installBtn = document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-block';
});
installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) { alert('Use your browser menu: Add to Home screen'); return; }
  deferredPrompt.prompt();
  const choice = await deferredPrompt.userChoice;
  deferredPrompt = null;
  installBtn.style.display = 'none';
});

// Service worker registration
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js').catch(()=>{/* ignore */});
}

render();
</script>
</body>
</html>
